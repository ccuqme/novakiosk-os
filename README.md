# novakiosk-os

[![bluebuild build badge](https://github.com/ccuqme/novakiosk-os/actions/workflows/build.yml/badge.svg)](https://github.com/ccuqme/novakiosk-os/actions/workflows/build.yml)
![License](https://img.shields.io/github/license/ccuqme/novakiosk-os)

`novakiosk-os` is a minimal [BlueBuild](https://blue-build.org) Fedora Atomic image recipe
for kiosk machines managed by [novakiosk](https://github.com/ccuqme/novakiosk) (optionally
with [novakeys](https://github.com/ccuqme/novakeys)).

`novakiosk` communicates with a kiosk agent running on the kiosk machine; 
this image provides the Sway session + browser and the OS-level dependencies that the kiosk agent expects.

## What’s included

- Sway session with auto-login via `greetd` (starts Sway as the `kiosk` user)
- Firefox as a system Flatpak (`org.mozilla.firefox`) for kiosk display
- `ydotool` for kiosk agent automation (e.g. forcing refresh / sending input)
- `wayvnc` for remote view/control (used by novakiosk’s VNC feature)
- `openssh-server` + `openssl` for direct SSH access and key management
- Build tooling used by kiosk-agent dependencies (e.g. `gcc-c++`/`make`/`python3` for `node-pty`, used for
  novakiosk's built-in web terminal) + `libatomic` for some Node.js runtimes

## Intended use

This repo is primarily an internal recipe, but it is shared for anyone building kiosks with
`novakiosk`/`novakeys` who wants a small, reproducible Fedora Atomic base.

The defaults are opinionated. If you need a different setup, expect to fork and
adjust the recipe.

Note: this repo does not ship the kiosk agent itself; it only provides the OS image and its
dependencies. The kiosk agent is served when onboarding the kiosk via the novakiosk web interface.

This project was built for [NOVA Spektrum](https://novaspektrum.no) in Norway and is
published with their permission. It is maintained by the author personally and
is not maintained, supported, or warranted by NOVA Spektrum.

NOVA Spektrum is a registered name and is not covered by this license.

## Installation (rebase)

> [!WARNING]  
> [This is an experimental feature](https://www.fedoraproject.org/wiki/Changes/OstreeNativeContainerStable),
> try at your own discretion.

To rebase an existing Fedora Atomic system to the latest build:

- First rebase to the unsigned image, to get the proper signing keys and policies installed:
  ```
  rpm-ostree rebase ostree-unverified-registry:ghcr.io/ccuqme/novakiosk-os:latest
  ```
- Reboot to complete the rebase:
  ```
  systemctl reboot
  ```
- Then rebase to the signed image, like so:
  ```
  rpm-ostree rebase ostree-image-signed:docker://ghcr.io/ccuqme/novakiosk-os:latest
  ```
- Reboot again to complete the installation
  ```
  systemctl reboot
  ```

## ISO

Prebuilt ISO snapshot: [novakiosk-os-20260204.iso](http://static.nova.onl/novakiosk-os-20260204.iso)

Checksum (SHA256): bd480a9a1205b5d5232be3e1d508e904dbef34a8713f991e087813caf5e65020

Note: After the first installation, you will be prompted to enroll the secure boot key in the BIOS.

Enter the password `universalblue` when prompted to enroll the key.

### Passwords / sudo / SSH

This image auto-logs into the `kiosk` account locally. The `kiosk` user is created at boot (via `systemd-sysusers`) and is intended to be a dedicated kiosk/service user, not your day-to-day admin account.

Important:
- Create a **separate admin user** during installation and use **that** user for SSH and administrative tasks. Do **not** name your admin user `kiosk`.
- The `kiosk` user’s password is **locked** by default (no password login). This is intentional and helps avoid interactive logins as `kiosk`.
- In this setup, `kiosk` has elevated privileges, but is expected to rely only on *explicitly allowed* passwordless sudo rules (for example, `systemctl reboot` / `poweroff`). Because `kiosk` can’t authenticate with a password, any `sudo` command that requires authentication (for example `sudo -i`) will fail; only `NOPASSWD:` (or other non-password) rules will work.
